# Public Flower Upload Scheduler

화훼 공공데이터 포털의 경매 데이터를 수집하고 가공하여 서비스에 필요한 형태로 변환하는 ETL 스케줄러 서비스입니다.

## 기술 스택

- Go 1.19+
- AWS Lambda
- PostgreSQL
- GORM
- Uber Zap Logger
- AWS API Gateway

## 핵심 기능

1. 공공데이터 수집 및 적재
2. 데이터 정규화 및 가공
3. 배치 작업 모니터링
4. 데이터 무결성 검증

## 아키텍처 설계 원칙

### 1. 데이터 파이프라인 설계

```
Raw Data (공공 API) -> ETL Process -> Normalized Data -> Business Logic
```

- **원천 데이터 보존**: 공공데이터 원본을 `public_bidding_flowers` 테이블에 보관
- **정규화된 데이터 구조**: 
  - `flower_types`: 화훼 품목 마스터 데이터
  - `flowers`: 개별 품종 정보
  - `bidding_flowers`: 실제 경매 데이터

### 2. 배치 프로세스 안정성 확보

1. **장애 복구 메커니즘**
   - Defer/Recover 패턴을 통한 panic 상황 처리
   - 실패 지점 추적을 위한 세분화된 로깅

2. **데이터 정합성 검증**
   - 업로드 전/후 데이터 검증
   - 중복 데이터 필터링
   - 데이터 타입 검증 및 변환

3. **모니터링 체계**
   - `FlowerBatchUploadLogs`: 원천 데이터 적재 현황 추적
   - `FlowerBatchProcessLogs`: 데이터 가공 프로세스 모니터링

### 3. 확장성을 고려한 설계

1. **모듈화된 구조**
   ```
   handlers -> services -> datastore
   ```
   - 계층별 명확한 책임 분리
   - 테스트 용이성 확보
   - 유지보수성 향상

2. **유연한 데이터 모델**
   - 화훼 품목과 품종의 분리로 데이터 확장성 확보
   - 공공데이터 스키마 변경에 대응 가능한 구조

### 4. 운영 효율성

1. **서버리스 아키텍처**
   - 운영 부담 최소화
   - 비용 효율성 확보
   - 자동 스케일링

2. **효율적인 데이터 처리**
   - Batch Insert를 통한 DB 부하 감소
   - In-memory 데이터 처리로 DB 조회 최소화
   - 중복 제거 로직으로 불필요한 데이터 처리 방지

## 주요 기술적 의사결정

### 1. 데이터 정규화 전략

원천 데이터를 그대로 사용하지 않고 정규화된 구조로 변환한 이유:
- 데이터 일관성 확보
- 중복 데이터 제거
- 효율적인 쿼리 성능
- 데이터 품질 관리 용이성

### 2. 로깅 전략

Uber의 Zap logger 채택 이유:
- 구조화된 로깅으로 모니터링 용이성 확보
- 높은 성능과 낮은 메모리 사용
- 레벨별 로깅으로 운영 편의성 제공

### 3. 배치 처리 전략

Map 자료구조를 활용한 In-memory 처리 방식 채택:
- DB 부하 감소
- 처리 속도 향상
- 메모리 사용량과 성능의 적절한 균형

## 모니터링 및 운영

### 1. 로그 추적
- 배치 업로드 현황
- 데이터 처리 결과
- 에러 발생 지점과 원인

### 2. 주요 모니터링 지표
- 신규 데이터 건수
- 데이터 처리 성공/실패율
- 프로세스 처리 시간
- 에러 발생 패턴

## 향후 개선 계획

1. **성능 최적화**
   - 병렬 처리 도입 검토
   - 캐싱 전략 도입

2. **데이터 품질 관리**
   - 데이터 검증 규칙 강화
   - 이상치 탐지 로직 추가

3. **운영 효율화**
   - 알림 시스템 구축
   - 대시보드 개발

4. **확장성**
   - 추가 데이터 소스 통합 준비
   - API 버저닝 전략 수립

## 기술적 도전과제 해결

1. **데이터 정합성 확보**
   - 트랜잭션 관리
   - 중복 제거 로직
   - 데이터 타입 검증

2. **성능 최적화**
   - Batch Processing
   - In-memory 처리
   - DB 쿼리 최적화

3. **운영 안정성**
   - 예외 처리
   - 로깅
   - 모니터링
